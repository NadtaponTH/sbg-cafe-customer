function displayCheckoutScreen(sessionData) {
            hideAllSections();
            document.getElementById('staff-header').classList.remove('hidden');
            ui.checkoutSection.style.display = 'block';
            ui.resetBtn.style.display = 'block';
            
            let playerHtml = '';
            sessionData.players.forEach(player => {
                playerHtml += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded mb-2">
                        <div>
                            <span class="font-medium">${player.nickname}</span>
                            <span class="text-sm text-gray-600 ml-2">(${player.ticketName || player.ticketType})</span>
                        </div>
                        <span class="text-sm text-blue-600">‡∏£‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</span>
                    </div>
                `;
            });

            const timePlayed = calculateDuration(sessionData.players[0].checkInTime);

            ui.checkoutSection.innerHTML = `
                <h2>‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h3 class="font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Session ID:</strong> ${sessionData.orderId}</p>
                            <p><strong>‡πÇ‡∏ï‡πä‡∏∞:</strong> ${sessionData.table}</p>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤:</strong> ${timePlayed}</p>
                        </div>
                        <div>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> ${formatTime(new Date())}</p>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</strong> ${timePlayed}</p>
                            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</strong> ${sessionData.players.length} ‡∏Ñ‡∏ô</p>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h3 class="font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
                    ${playerHtml}
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                    <div class="flex items-center">
                        <span class="text-2xl mr-2">üßÆ</span>
                        <div>
                            <p class="font-semibold text-yellow-800">‡∏£‡∏≤‡∏Ña‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á</p>
                            <p class="text-sm text-yellow-700">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siam Board Games - Staff POS</title>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .scanner-container { position: relative; border-radius: 12px; overflow: hidden; }
        .scanner-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
        .scanner-corners { position: absolute; width: 40px; height: 40px; border: 3px solid #3b82f6; }
        .corner-tl { top: 20px; left: 20px; border-right: none; border-bottom: none; }
        .corner-tr { top: 20px; right: 20px; border-left: none; border-bottom: none; }
        .corner-bl { bottom: 20px; left: 20px; border-right: none; border-top: none; }
        .corner-br { bottom: 20px; right: 20px; border-left: none; border-top: none; }
        
        .receipt-style {
            font-family: 'Courier New', monospace;
            background: white;
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 10px 0;
            white-space: pre-line;
        }
        
        .status-success { background-color: #d1fae5; color: #065f46; border-color: #10b981; }
        .status-error { background-color: #fee2e2; color: #991b1b; border-color: #ef4444; }
        .status-warning { background-color: #fef3c7; color: #92400e; border-color: #f59e0b; }
        
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:bg-gray-400; }
        .btn-secondary { @apply bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors; }
        .btn-success { @apply bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors; }
        .btn-danger { @apply bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö POS...</p>
        </div>
    </div>

    <!-- Header -->
    <header id="header" class="bg-white shadow-sm border-b hidden">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold text-gray-800">üé≤ Siam Board Games</h1>
                    <span id="staff-badge" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium"></span>
                </div>
                <div id="branch-selector" class="flex items-center space-x-2">
                    <label class="text-sm text-gray-600">‡∏™‡∏≤‡∏Ç‡∏≤:</label>
                    <select id="branch-select" class="border rounded-lg px-3 py-1 text-sm">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                        <option value="Bangna">Bangna</option>
                        <option value="Ngamwongwan">Ngamwongwan</option>
                        <option value="WestGate">WestGate</option>
                        <option value="EastVille">EastVille</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="max-w-4xl mx-auto px-4 py-6">
        <!-- Status Message -->
        <div id="status-message" class="hidden p-4 rounded-lg border mb-6">
            <div class="flex items-center">
                <span id="status-icon" class="mr-2"></span>
                <span id="status-text"></span>
            </div>
        </div>

        <!-- Login Screen -->
        <div id="login-screen" class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
                <p class="text-gray-600 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™ PIN (4 ‡∏´‡∏•‡∏±‡∏Å)</label>
                    <input type="password" id="pin-input" 
                           class="w-full p-3 border border-gray-300 rounded-lg text-center text-2xl tracking-widest"
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric">
                </div>
                <button type="submit" class="w-full btn-primary">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
        </div>

        <!-- Main POS Interface -->
        <div id="pos-interface" class="hidden fade-in">
            
            <!-- Customer Search Section -->
            <div id="search-section" class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                
                <!-- QR Scanner -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-3">‡∏™‡πÅ‡∏Å‡∏ô QR Code</h4>
                        <div id="qr-scanner" class="scanner-container bg-gray-100 aspect-square rounded-lg flex items-center justify-center">
                            <button id="start-scan-btn" class="btn-primary">
                                üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô
                            </button>
                            <div class="scanner-overlay hidden">
                                <div class="scanner-corners corner-tl"></div>
                                <div class="scanner-corners corner-tr"></div>
                                <div class="scanner-corners corner-bl"></div>
                                <div class="scanner-corners corner-br"></div>
                            </div>
                        </div>
                        <button id="stop-scan-btn" class="w-full mt-2 btn-secondary hidden">‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô</button>
                    </div>
                    
                    <!-- Manual Search -->
                    <div>
                        <h4 class="font-medium text-gray-700 mb-3">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h4>
                        <form id="manual-search-form" class="space-y-3">
                            <input type="text" id="customer-id-input" 
                                   class="w-full p-3 border border-gray-300 rounded-lg"
                                   placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÄ‡∏ä‡πà‡∏ô 01250001)">
                            <button type="submit" class="w-full btn-primary">
                                üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                            </button>
                        </form>
                        
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                            <p class="text-sm text-gray-600">üí° <strong>‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ:</strong> ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà QR Code ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Info & Session Management -->
            <div id="customer-section" class="hidden bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <button id="back-to-search-btn" class="btn-secondary">üîô ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                
                <div id="customer-info" class="bg-blue-50 p-4 rounded-lg mb-4"></div>
                
                <!-- Active Session Display -->
                <div id="active-session" class="hidden">
                    <h4 class="font-semibold text-red-600 mb-3">üéÆ ‡∏°‡∏µ‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà</h4>
                    <div id="session-details" class="bg-red-50 p-4 rounded-lg mb-4"></div>
                    <button id="proceed-checkout-btn" class="btn-danger">üí∞ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ Check-out</button>
                </div>
                
                <!-- New Session Setup -->
                <div id="new-session" class="hidden">
                    <h4 class="font-semibold text-green-600 mb-3">‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</h4>
                    <form id="session-form" class="space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡πÇ‡∏ï‡πä‡∏∞</label>
                                <input type="text" id="table-input" required
                                       class="w-full p-3 border border-gray-300 rounded-lg"
                                       placeholder="‡πÄ‡∏ä‡πà‡∏ô A1, B2, C3">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</label>
                                <div class="flex items-center space-x-2">
                                    <button type="button" id="decrease-players" class="btn-secondary px-3 py-2">-</button>
                                    <input type="number" id="players-count" value="1" min="1" max="8"
                                           class="w-20 p-3 border border-gray-300 rounded-lg text-center">
                                    <button type="button" id="increase-players" class="btn-secondary px-3 py-2">+</button>
                                </div>
                            </div>
                        </div>
                        <button type="button" id="setup-players-btn" class="btn-primary">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</button>
                    </form>
                </div>
            </div>

            <!-- Players Setup -->
            <div id="players-section" class="hidden bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πã‡∏ß</h3>
                <div id="players-list" class="space-y-4 mb-6"></div>
                
                <!-- Debug Button - Remove this after testing -->
                <div class="mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <p class="text-sm text-yellow-700 mb-2">üîß Debug: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°</p>
                    <button id="debug-check-btn" class="btn-secondary text-sm py-1 px-3">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                </div>
                
                <div class="flex space-x-4">
                    <button id="confirm-checkin-btn" class="flex-1 bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg opacity-50 cursor-not-allowed" disabled>
                        ‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                    </button>
                    <button id="cancel-setup-btn" class="btn-secondary">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>

            <!-- Checkout Section -->
            <div id="checkout-section" class="hidden bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                <div id="checkout-details" class="space-y-4 mb-6"></div>
                <form id="checkout-form" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="special-discount" value="0" min="0" step="0.5"
                                   class="w-full p-3 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
                            <select id="payment-method" class="w-full p-3 border border-gray-300 rounded-lg">
                                <option value="Cash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                                <option value="Credit Card">‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
                                <option value="QR Code">QR Code</option>
                                <option value="Bank Transfer">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="checkout-notes" rows="2" 
                                  class="w-full p-3 border border-gray-300 rounded-lg"
                                  placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                    </div>
                    <button type="submit" class="w-full btn-success">üí≥ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
                </form>
            </div>

            <!-- Receipt Display -->
            <div id="receipt-section" class="hidden bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</h3>
                    <button id="print-receipt-btn" class="btn-primary">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
                </div>
                <div id="receipt-content" class="receipt-style"></div>
                <div class="flex space-x-4 mt-6">
                    <button id="new-customer-btn" class="flex-1 btn-primary">üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="same-customer-btn" class="flex-1 btn-secondary">üîÑ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</button>
                </div>
            </div>

        </div>
    </main>

    <!-- Print Modal -->
    <div id="print-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</h3>
            <div id="printer-status" class="mb-4">
                <p class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå Bluetooth...</p>
            </div>
            <div id="printer-list" class="space-y-2 mb-4"></div>
            <div class="flex space-x-4">
                <button id="close-print-modal" class="flex-1 btn-secondary">‡∏õ‡∏¥‡∏î</button>
                <button id="manual-print-btn" class="flex-1 btn-primary">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = 'https://script.google.com/macros/s/AKfycbxOI8uLSHi2Tbv_9KWu8OOcTMjaN5dkL_4CIJR_YpcIhwK7mX-WX1MD-xJAmthVsjaF/exec';
        
        // Application State
        const state = {
            staff: null,
            branch: null,
            customer: null,
            session: null,
            tickets: [],
            currentPlayers: [],
            scanner: null,
            isScanning: false
        };

        // DOM Elements
        const elements = {
            loadingScreen: document.getElementById('loading-screen'),
            header: document.getElementById('header'),
            statusMessage: document.getElementById('status-message'),
            loginScreen: document.getElementById('login-screen'),
            posInterface: document.getElementById('pos-interface'),
            staffBadge: document.getElementById('staff-badge'),
            branchSelect: document.getElementById('branch-select'),
            searchSection: document.getElementById('search-section'),
            customerSection: document.getElementById('customer-section'),
            playersSection: document.getElementById('players-section'),
            checkoutSection: document.getElementById('checkout-section'),
            receiptSection: document.getElementById('receipt-section')
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', async () => {
            await loadTickets();
            hideLoading();
            setupEventListeners();
        });

        // API Functions
        async function apiGet(action, params = {}) {
            const url = new URL(API_URL);
            url.searchParams.append('action', action);
            Object.entries(params).forEach(([key, value]) => {
                url.searchParams.append(key, value);
            });

            const response = await fetch(url);
            if (!response.ok) throw new Error(`Network error: ${response.statusText}`);
            return await response.json();
        }

        async function apiPost(payload) {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`Network error: ${response.statusText}`);
            return await response.json();
        }

        // Utility Functions
        function showStatus(message, type = 'info', duration = 5000) {
            const statusMessage = elements.statusMessage;
            const statusText = document.getElementById('status-text');
            const statusIcon = document.getElementById('status-icon');
            
            statusMessage.className = `p-4 rounded-lg border mb-6 status-${type}`;
            statusText.textContent = message;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            statusIcon.textContent = icons[type] || '‚ÑπÔ∏è';
            
            statusMessage.classList.remove('hidden');
            
            if (duration > 0) {
                setTimeout(() => statusMessage.classList.add('hidden'), duration);
            }
        }

        function hideLoading() {
            elements.loadingScreen.classList.add('hidden');
            elements.header.classList.remove('hidden');
        }

        function showScreen(screenName) {
            const screens = ['search-section', 'customer-section', 'players-section', 'checkout-section', 'receipt-section'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            
            // Stop QR scanner when navigating away from search
            if (state.isScanning && screenName !== 'search-section') {
                stopQRScanner();
            }
            
            if (screenName) {
                document.getElementById(screenName).classList.remove('hidden');
                
                // Reinitialize QR scanner when returning to search
                if (screenName === 'search-section') {
                    setTimeout(() => {
                        setupScannerEvents();
                    }, 100);
                }
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('th-TH', {
                style: 'currency',
                currency: 'THB',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return hours > 0 ? `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${mins} ‡∏ô‡∏≤‡∏ó‡∏µ` : `${mins} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        }

        function formatTime(date) {
            return new Date(date).toLocaleTimeString('th-TH', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Authentication Functions
        async function handleLogin(e) {
            e.preventDefault();
            const pin = document.getElementById('pin-input').value;
            const submitBtn = e.target.querySelector('button[type="submit"]');
            
            if (pin.length !== 4) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ PIN 4 ‡∏´‡∏•‡∏±‡∏Å', 'error');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

            try {
                const result = await apiGet('staffLogin', { pin });
                if (result.success) {
                    state.staff = result.data;
                    elements.staffBadge.textContent = `üë®‚Äçüíº ${state.staff.staffName}`;
                    elements.loginScreen.classList.add('hidden');
                    elements.posInterface.classList.remove('hidden');
                    showStatus(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${state.staff.staffName}!`, 'success');
                } else {
                    showStatus(result.message, 'error');
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö';
            }
        }

        // Branch Selection
        function handleBranchChange(e) {
            state.branch = e.target.value;
            if (state.branch) {
                showStatus(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤: ${state.branch}`, 'success');
                showScreen('search-section');
            }
        }

        // Ticket Loading
        async function loadTickets() {
            try {
                const result = await apiGet('getTickets');
                if (result.success) {
                    state.tickets = result.data;
                }
            } catch (error) {
                console.error('Failed to load tickets:', error);
            }
        }

        // QR Scanner Functions
        function startQRScanner() {
            const scannerElement = document.getElementById('qr-scanner');
            const startBtn = document.getElementById('start-scan-btn');
            const stopBtn = document.getElementById('stop-scan-btn');
            
            if (state.isScanning) return;

            state.scanner = new Html5Qrcode("qr-scanner");
            
            state.scanner.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: { width: 250, height: 250 } },
                (decodedText) => {
                    stopQRScanner();
                    handleCustomerFound(decodedText, 'qr');
                },
                (errorMessage) => {
                    // Ignore scanning errors
                }
            ).then(() => {
                state.isScanning = true;
                startBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                document.querySelector('.scanner-overlay').classList.remove('hidden');
            }).catch(err => {
                showStatus('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï', 'error');
            });
        }

        function stopQRScanner() {
            if (state.scanner && state.isScanning) {
                state.scanner.stop().then(() => {
                    state.isScanning = false;
                    resetScannerUI();
                }).catch(err => {
                    console.error('Error stopping scanner:', err);
                    state.isScanning = false;
                    resetScannerUI();
                });
            }
        }

        function resetScannerUI() {
            const scannerContainer = document.getElementById('qr-scanner');
            scannerContainer.innerHTML = `
                <button id="start-scan-btn" class="btn-primary">üì∑ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô</button>
                <div class="scanner-overlay hidden">
                    <div class="scanner-corners corner-tl"></div>
                    <div class="scanner-corners corner-tr"></div>
                    <div class="scanner-corners corner-bl"></div>
                    <div class="scanner-corners corner-br"></div>
                </div>
            `;
        }

        function setupScannerEvents() {
            const startBtn = document.getElementById('start-scan-btn');
            const stopBtn = document.getElementById('stop-scan-btn');
            
            if (startBtn) {
                startBtn.addEventListener('click', startQRScanner);
            }
            if (stopBtn) {
                stopBtn.addEventListener('click', stopQRScanner);
            }
        }

        // Customer Search Functions
        async function handleManualSearch(e) {
            e.preventDefault();
            const customerId = document.getElementById('customer-id-input').value.trim();
            const submitBtn = e.target.querySelector('button[type="submit"]');
            
            if (!customerId) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', 'warning');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...';

            try {
                const result = await apiGet('getMemberByCustomerId', { customerId });
                if (result.success) {
                    // IMPORTANT: Use the actual userId returned from the search
                    const actualUserId = result.data.userId;
                    console.log('Manual search found userId:', actualUserId, 'for customerId:', customerId);
                    await handleCustomerFound(actualUserId, 'manual');
                } else {
                    showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ', 'error');
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
            }
        }

        async function handleCustomerFound(userId, source) {
            showStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤...', 'info', 0);
            
            try {
                const result = await apiGet('getInitialData', { userId });
                if (result.success) {
                    state.customer = result.data;
                    
                    // IMPORTANT: Store the actual userId for later use
                    if (state.customer.memberInfo) {
                        state.customer.memberInfo.userId = userId; // Ensure we have the actual LINE User ID
                        state.customer.userId = userId; // Also store it at top level
                    } else {
                        // For non-members, still store the userId
                        state.customer = {
                            ...state.customer,
                            userId: userId,
                            memberInfo: null
                        };
                    }
                    
                    displayCustomerInfo();
                    
                    if (state.customer.activeSession) {
                        displayActiveSession();
                    } else {
                        displayNewSessionForm();
                    }
                    
                    showScreen('customer-section');
                    
                    const customerName = state.customer.memberInfo?.nickname || 'Guest';
                    showStatus(`‡∏û‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${customerName} (UserID: ${userId})`, 'success');
                    console.log('Customer found with UserID:', userId, 'Customer data:', state.customer);
                } else {
                    showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        function displayCustomerInfo() {
            const customerInfo = document.getElementById('customer-info');
            const member = state.customer.memberInfo;
            
            if (member) {
                customerInfo.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-lg">${member.nickname || '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'}</h4>
                            <p class="text-gray-600">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member.customerId}</p>
                            ${member.phone ? `<p class="text-gray-600">‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${member.phone}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                ‚úÖ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
                            </span>
                        </div>
                    </div>
                `;
            } else {
                customerInfo.innerHTML = `
                    <div class="text-center py-4">
                        <h4 class="font-semibold text-lg text-orange-600">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h4>
                        <p class="text-gray-600">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>
                        <p class="text-sm text-blue-600 mt-2">üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©</p>
                    </div>
                `;
            }
        }

        function displayActiveSession() {
            const activeSessionDiv = document.getElementById('active-session');
            const sessionDetailsDiv = document.getElementById('session-details');
            const session = state.customer.activeSession;
            
            const checkInTime = new Date(session.checkInTime);
            const currentTime = new Date();
            const duration = Math.floor((currentTime - checkInTime) / (1000 * 60));
            
            let playersHtml = '';
            session.players.forEach(player => {
                playersHtml += `
                    <div class="flex justify-between items-center p-2 bg-white rounded border">
                        <span>${player.nickname}</span>
                        <span class="text-sm text-gray-600">${player.ticketType}</span>
                    </div>
                `;
            });
            
            sessionDetailsDiv.innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <p><strong>Session ID:</strong> ${session.sessionId}</p>
                        <p><strong>‡∏™‡∏≤‡∏Ç‡∏≤:</strong> ${session.branch}</p>
                        <p><strong>‡πÇ‡∏ï‡πä‡∏∞:</strong> ${session.table}</p>
                        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤:</strong> ${formatTime(session.checkInTime)}</p>
                        <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</strong> <span class="font-bold text-red-600">${formatDuration(duration)}</span></p>
                    </div>
                    <div>
                        <p class="font-medium mb-2">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô (${session.players.length} ‡∏Ñ‡∏ô):</p>
                        <div class="space-y-1">
                            ${playersHtml}
                        </div>
                    </div>
                </div>
            `;
            
            activeSessionDiv.classList.remove('hidden');
            document.getElementById('new-session').classList.add('hidden');
        }

        function displayNewSessionForm() {
            document.getElementById('active-session').classList.add('hidden');
            document.getElementById('new-session').classList.remove('hidden');
        }

        // Session Management Functions
        function handlePlayerCountChange(delta) {
            const input = document.getElementById('players-count');
            const currentValue = parseInt(input.value);
            const newValue = Math.max(1, Math.min(8, currentValue + delta));
            input.value = newValue;
        }

        function setupPlayers() {
            const playersCount = parseInt(document.getElementById('players-count').value);
            const table = document.getElementById('table-input').value.trim();
            
            if (!table) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏ï‡πä‡∏∞', 'warning');
                return;
            }
            
            if (!state.branch) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'warning');
                return;
            }

            // Initialize players array
            state.currentPlayers = [];
            
            for (let i = 0; i < playersCount; i++) {
                if (i === 0 && state.customer.memberInfo) {
                    // FIXED: First player should use the actual member's LINE User ID, not a GUEST ID
                    state.currentPlayers.push({
                        userId: state.customer.memberInfo.userId || getActualUserIdFromCustomer(), // Use real LINE User ID
                        nickname: state.customer.memberInfo.nickname,
                        customerId: state.customer.memberInfo.customerId,
                        isMember: true
                    });
                } else {
                    // Additional players are guests
                    state.currentPlayers.push({
                        userId: `GUEST_${Date.now()}_${i}`,
                        nickname: `‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${i + 1}`,
                        customerId: null,
                        isMember: false
                    });
                }
            }

            displayPlayersSetup();
            showScreen('players-section');
        }
        
        // Helper function to get the actual User ID from the customer search
        function getActualUserIdFromCustomer() {
            // This should be set when we found the customer via QR/manual search
            // The customer object should contain the actual LINE User ID
            if (state.customer && state.customer.memberInfo && state.customer.memberInfo.userId) {
                return state.customer.memberInfo.userId;
            }
            
            // Fallback: if we don't have it in memberInfo, we might have it from the search
            if (state.customer && state.customer.userId) {
                return state.customer.userId;
            }
            
            console.error('Could not find actual User ID for customer');
            return `UNKNOWN_USER_${Date.now()}`;
        }

        function displayPlayersSetup() {
            const playersListDiv = document.getElementById('players-list');
            playersListDiv.innerHTML = '';

            state.currentPlayers.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'bg-gray-50 p-4 rounded-lg border';
                
                let ticketOptions = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß --</option>';
                state.tickets.forEach(ticket => {
                    // Fix: Properly escape JSON for HTML attributes
                    const ticketJson = JSON.stringify(ticket).replace(/"/g, '&quot;');
                    ticketOptions += `<option value="${ticketJson}">${ticket.name} - ${formatCurrency(ticket.price)}</option>`;
                });

                playerDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium">${player.nickname}</h4>
                        ${player.isMember ? 
                            '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>' : 
                            '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>'
                        }
                    </div>
                    <div class="grid md:grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡∏±‡πã‡∏ß</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg ticket-select" data-index="${index}" required>
                                ${ticketOptions}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg customer-type-select" data-index="${index}" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                                <option value="Adult">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà</option>
                                <option value="Student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                <option value="Child">‡πÄ‡∏î‡πá‡∏Å</option>
                                <option value="Senior">‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</option>
                            </select>
                        </div>
                    </div>
                `;

                playersListDiv.appendChild(playerDiv);
            });

            // Add event listeners for player updates
            document.querySelectorAll('.ticket-select, .customer-type-select').forEach(select => {
                select.addEventListener('change', updatePlayerInfo);
                select.addEventListener('input', updatePlayerInfo);
                
                // Force check current values in case they're already selected
                if (select.value) {
                    updatePlayerInfo({ target: select });
                }
            });
            
            // Initialize button state
            updateCheckInButtonState();
            
            // Force check all current values after a short delay
            setTimeout(() => {
                document.querySelectorAll('.ticket-select, .customer-type-select').forEach(select => {
                    if (select.value) {
                        console.log('Force checking select:', select.className, select.value);
                        updatePlayerInfo({ target: select });
                    }
                });
                updateCheckInButtonState();
            }, 500);
        }

        function updatePlayerInfo(e) {
            const index = parseInt(e.target.dataset.index);
            const isTicketSelect = e.target.classList.contains('ticket-select');
            
            // Reset border color when user makes a selection
            e.target.style.borderColor = '#d1d5db';
            
            if (isTicketSelect) {
                if (e.target.value) {
                    try {
                        // Fix: Unescape HTML entities before parsing JSON
                        const unescapedValue = e.target.value.replace(/&quot;/g, '"');
                        const ticketData = JSON.parse(unescapedValue);
                        state.currentPlayers[index].selectedTicket = ticketData;
                        console.log(`Player ${index} ticket selected:`, ticketData);
                    } catch (error) {
                        console.error('Error parsing ticket data:', error);
                        console.log('Raw value:', e.target.value);
                        console.log('Trying alternative parsing...');
                        
                        // Alternative: try to extract ticket info from the selected option text
                        const selectedOption = e.target.options[e.target.selectedIndex];
                        if (selectedOption && selectedOption.text) {
                            const text = selectedOption.text; // e.g., "70THB/Hrs - ‡∏ø70"
                            const parts = text.split(' - ‡∏ø');
                            if (parts.length === 2) {
                                const ticketData = {
                                    name: parts[0],
                                    price: parseFloat(parts[1]) || 0,
                                    type: 'PARSED'
                                };
                                state.currentPlayers[index].selectedTicket = ticketData;
                                console.log(`Player ${index} ticket parsed from text:`, ticketData);
                            }
                        } else {
                            state.currentPlayers[index].selectedTicket = null;
                        }
                    }
                } else {
                    state.currentPlayers[index].selectedTicket = null;
                }
            } else {
                if (e.target.value) {
                    state.currentPlayers[index].customerType = e.target.value;
                    console.log(`Player ${index} customer type selected:`, e.target.value);
                } else {
                    state.currentPlayers[index].customerType = null;
                }
            }
            
            // Debug: Log current player state
            console.log(`Player ${index} current state:`, state.currentPlayers[index]);
            
            // Check if all fields are filled to enable/disable check-in button
            updateCheckInButtonState();
        }

        function updateCheckInButtonState() {
            const confirmBtn = document.getElementById('confirm-checkin-btn');
            if (!confirmBtn) {
                console.log('Confirm button not found');
                return;
            }
            
            let allValid = true;
            let validationDetails = [];
            
            state.currentPlayers.forEach((player, index) => {
                const hasTicket = player.selectedTicket && player.selectedTicket.name;
                const hasCustomerType = player.customerType;
                
                validationDetails.push({
                    index,
                    nickname: player.nickname,
                    hasTicket,
                    hasCustomerType,
                    ticket: player.selectedTicket?.name || 'Not selected',
                    customerType: player.customerType || 'Not selected'
                });
                
                if (!hasTicket || !hasCustomerType) {
                    allValid = false;
                }
            });
            
            console.log('Validation details:', validationDetails);
            console.log('All valid:', allValid);
            
            if (allValid) {
                confirmBtn.disabled = false;
                confirmBtn.className = 'flex-1 btn-success';
                confirmBtn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Check-in';
                confirmBtn.style.opacity = '1';
                confirmBtn.style.cursor = 'pointer';
                console.log('Button enabled');
            } else {
                confirmBtn.disabled = true;
                confirmBtn.className = 'flex-1 bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg opacity-50 cursor-not-allowed';
                confirmBtn.textContent = '‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô';
                confirmBtn.style.opacity = '0.5';
                confirmBtn.style.cursor = 'not-allowed';
                console.log('Button disabled - missing fields');
            }
        }

        // Check-in Functions
        async function handleCheckIn() {
            const table = document.getElementById('table-input').value.trim();
            const confirmBtn = document.getElementById('confirm-checkin-btn');
            
            // Validate all players have tickets and customer types selected
            for (let i = 0; i < state.currentPlayers.length; i++) {
                const player = state.currentPlayers[i];
                
                if (!player.selectedTicket) {
                    showStatus(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πã‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${player.nickname}`, 'warning');
                    // Highlight the missing field
                    const ticketSelect = document.querySelector(`[data-index="${i}"].ticket-select`);
                    if (ticketSelect) {
                        ticketSelect.style.borderColor = '#ef4444';
                        ticketSelect.focus();
                    }
                    return;
                }
                
                if (!player.customerType) {
                    showStatus(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${player.nickname}`, 'warning');
                    // Highlight the missing field
                    const typeSelect = document.querySelector(`[data-index="${i}"].customer-type-select`);
                    if (typeSelect) {
                        typeSelect.style.borderColor = '#ef4444';
                        typeSelect.focus();
                    }
                    return;
                }
            }

            confirmBtn.disabled = true;
            confirmBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            try {
                const playersData = state.currentPlayers.map(player => {
                    console.log(`Check-in player: ${player.nickname}, UserID: ${player.userId}, isMember: ${player.isMember}`);
                    return {
                        userId: player.userId,
                        ticketType: player.selectedTicket.name,
                        basePrice: player.selectedTicket.price,
                        customerType: player.customerType
                    };
                });

                console.log('Check-in payload players:', playersData);

                const payload = {
                    action: 'checkIn',
                    branch: state.branch,
                    table: table,
                    players: playersData,
                    staffId: state.staff.staffName
                };

                const result = await apiPost(payload);
                if (result.success) {
                    showStatus(`Check-in ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! Session ID: ${result.data.sessionId}`, 'success');
                    setTimeout(() => {
                        backToSearch();
                    }, 2000);
                } else {
                    showStatus(result.message, 'error');
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Check-in';
            }
        }

        // Checkout Functions
        async function proceedToCheckout() {
            const session = state.customer.activeSession;
            showScreen('checkout-section');
            
            // Display checkout details
            const checkoutDetailsDiv = document.getElementById('checkout-details');
            
            const checkInTime = new Date(session.checkInTime);
            const currentTime = new Date();
            const duration = Math.floor((currentTime - checkInTime) / (1000 * 60));
            
            let playersHtml = '';
            let totalBasePrice = 0;
            
            session.players.forEach(player => {
                const price = player.basePrice || 0;
                totalBasePrice += price;
                playersHtml += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <div>
                            <span class="font-medium">${player.nickname}</span>
                            <span class="text-sm text-gray-600 ml-2">(${player.ticketType})</span>
                        </div>
                        <span class="font-medium">${formatCurrency(price)}</span>
                    </div>
                `;
            });

            checkoutDetailsDiv.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô</h4>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p><strong>Session ID:</strong> ${session.sessionId}</p>
                            <p><strong>‡πÇ‡∏ï‡πä‡∏∞:</strong> ${session.table}</p>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤:</strong> ${formatTime(session.checkInTime)}</p>
                        </div>
                        <div>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> ${formatTime(currentTime)}</p>
                            <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô:</strong> <span class="font-bold">${formatDuration(duration)}</span></p>
                            <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</strong> ${session.players.length} ‡∏Ñ‡∏ô</p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-2 mb-4">
                    <h4 class="font-semibold">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h4>
                    ${playersHtml}
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <div class="flex justify-between items-center">
                        <span class="font-semibold">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° (‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î):</span>
                        <span class="text-xl font-bold">${formatCurrency(totalBasePrice)}</span>
                    </div>
                </div>
            `;
        }

        async function handleCheckout(e) {
            e.preventDefault();
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const specialDiscount = parseFloat(document.getElementById('special-discount').value) || 0;
            const paymentMethod = document.getElementById('payment-method').value;
            const notes = document.getElementById('checkout-notes').value;
            
            submitBtn.disabled = true;
            submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...';

            try {
                const payload = {
                    action: 'checkOut',
                    sessionId: state.customer.activeSession.sessionId,
                    specialDiscount: specialDiscount,
                    paymentMethod: paymentMethod,
                    notes: notes,
                    staffId: state.staff.staffName
                };

                const result = await apiPost(payload);
                if (result.success) {
                    displayReceipt(result.data);
                    showScreen('receipt-section');
                    showStatus('‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'success');
                } else {
                    showStatus(result.message, 'error');
                }
            } catch (error) {
                showStatus(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üí≥ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
            }
        }

        // Receipt Functions
        function displayReceipt(checkoutData) {
            const receiptContent = document.getElementById('receipt-content');
            const now = new Date();
            
            receiptContent.textContent = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            SIAM BOARD GAMES
                 ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${now.toLocaleDateString('th-TH')}
‡πÄ‡∏ß‡∏•‡∏≤: ${now.toLocaleTimeString('th-TH')}
‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${state.staff.staffName}
‡∏™‡∏≤‡∏Ç‡∏≤: ${state.branch}

Session ID: ${checkoutData.sessionId}
‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡πà‡∏ô: ${formatDuration(checkoutData.duration)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö:        ${formatCurrency(checkoutData.basePrice)}
${checkoutData.promotionApplied !== 'None' ? 
`‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: ${checkoutData.promotionApplied}
‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: -${formatCurrency(checkoutData.discountAmount)}` : ''}

‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:        ${formatCurrency(checkoutData.finalPrice)}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

          ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
      ‡πÄ‡∏Å‡∏°‡∏™‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            `;

            state.lastCheckoutData = checkoutData;
        }

        // Printing Functions
        async function handlePrint() {
            if ('bluetooth' in navigator) {
                document.getElementById('print-modal').classList.remove('hidden');
                document.getElementById('print-modal').classList.add('flex');
                await searchBluetoothPrinters();
            } else {
                showManualPrint();
            }
        }

        async function searchBluetoothPrinters() {
            const printerStatus = document.getElementById('printer-status');
            const printerList = document.getElementById('printer-list');
            
            try {
                printerStatus.innerHTML = '<p class="text-blue-600">üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...</p>';
                
                const device = await navigator.bluetooth.requestDevice({
                    filters: [
                        { services: ['000018f0-0000-1000-8000-00805f9b34fb'] }, // Common printer service
                        { namePrefix: 'POS' },
                        { namePrefix: 'Thermal' },
                        { namePrefix: 'Receipt' }
                    ],
                    optionalServices: ['000018f0-0000-1000-8000-00805f9b34fb']
                });

                if (device) {
                    printerList.innerHTML = `
                        <div class="p-3 border border-blue-300 rounded-lg bg-blue-50">
                            <div class="flex items-center justify-between">
                                <span>${device.name}</span>
                                <button class="btn-primary text-sm py-1 px-3" onclick="connectToPrinter('${device.id}')">
                                    ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
                                </button>
                            </div>
                        </div>
                    `;
                    printerStatus.innerHTML = '<p class="text-green-600">‚úÖ ‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</p>';
                } else {
                    printerStatus.innerHTML = '<p class="text-yellow-600">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</p>';
                }
            } catch (error) {
                printerStatus.innerHTML = '<p class="text-red-600">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>';
                console.error('Bluetooth search error:', error);
            }
        }

        function showManualPrint() {
            const receiptText = document.getElementById('receipt-content').textContent;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à - Siam Board Games</title>
                    <style>
                        body { font-family: 'Courier New', monospace; white-space: pre-line; }
                        @media print { body { margin: 0; } }
                    </style>
                </head>
                <body>${receiptText}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            closePrintModal();
        }

        function closePrintModal() {
            document.getElementById('print-modal').classList.add('hidden');
            document.getElementById('print-modal').classList.remove('flex');
        }

        // Navigation Functions
        function backToSearch() {
            state.customer = null;
            state.currentPlayers = [];
            showScreen('search-section');
            
            // Reset forms
            document.getElementById('customer-id-input').value = '';
            document.getElementById('table-input').value = '';
            document.getElementById('players-count').value = '1';
            
            // Stop scanner if running
            if (state.isScanning) {
                stopQRScanner();
            }
        }

        function continueWithSameCustomer() {
            // Reload customer data and show customer section
            if (state.customer && state.customer.memberInfo) {
                handleCustomerFound(state.customer.memberInfo.userId, 'continue');
            } else {
                backToSearch();
            }
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Login
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Branch selection
            elements.branchSelect.addEventListener('change', handleBranchChange);
            
            // Search
            document.getElementById('manual-search-form').addEventListener('submit', handleManualSearch);
            setupScannerEvents();
            
            // Customer section
            document.getElementById('back-to-search-btn').addEventListener('click', backToSearch);
            document.getElementById('proceed-checkout-btn').addEventListener('click', proceedToCheckout);
            
            // Session setup
            document.getElementById('decrease-players').addEventListener('click', () => handlePlayerCountChange(-1));
            document.getElementById('increase-players').addEventListener('click', () => handlePlayerCountChange(1));
            document.getElementById('setup-players-btn').addEventListener('click', setupPlayers);
            
            // Players section
            document.getElementById('confirm-checkin-btn').addEventListener('click', handleCheckIn);
            document.getElementById('cancel-setup-btn').addEventListener('click', () => showScreen('customer-section'));
            
            // Debug button
            document.addEventListener('click', (e) => {
                if (e.target.id === 'debug-check-btn') {
                    handleDebugCheck();
                }
            });
            
            // Checkout
            document.getElementById('checkout-form').addEventListener('submit', handleCheckout);
            
            // Receipt
            document.getElementById('print-receipt-btn').addEventListener('click', handlePrint);
            document.getElementById('new-customer-btn').addEventListener('click', backToSearch);
            document.getElementById('same-customer-btn').addEventListener('click', continueWithSameCustomer);
            
            // Print modal
            document.getElementById('close-print-modal').addEventListener('click', closePrintModal);
            document.getElementById('manual-print-btn').addEventListener('click', showManualPrint);
            
            // PIN input - auto submit when 4 digits entered
            document.getElementById('pin-input').addEventListener('input', (e) => {
                if (e.target.value.length === 4) {
                    document.getElementById('login-form').dispatchEvent(new Event('submit'));
                }
            });
        }

        // Debug function to manually check current state
        function handleDebugCheck() {
            console.log('=== DEBUG CHECK ===');
            console.log('Current players:', state.currentPlayers);
            
            // Check all selects manually
            document.querySelectorAll('.ticket-select, .customer-type-select').forEach((select, i) => {
                console.log(`Select ${i}:`, {
                    className: select.className,
                    dataIndex: select.dataset.index,
                    value: select.value,
                    selectedIndex: select.selectedIndex,
                    selectedText: select.options[select.selectedIndex]?.text
                });
                
                // Force trigger update
                if (select.value) {
                    updatePlayerInfo({ target: select });
                }
            });
            
            updateCheckInButtonState();
            console.log('=== END DEBUG ===');
        }

        // Make functions globally available for onclick handlers
        window.connectToPrinter = async function(deviceId) {
            // Implement Bluetooth printer connection
            try {
                const printerStatus = document.getElementById('printer-status');
                printerStatus.innerHTML = '<p class="text-blue-600">üîó ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>';
                
                // This would need actual printer-specific implementation
                // For now, just show manual print as fallback
                setTimeout(() => {
                    printerStatus.innerHTML = '<p class="text-green-600">‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...</p>';
                    setTimeout(() => {
                        showManualPrint();
                    }, 1000);
                }, 2000);
                
            } catch (error) {
                console.error('Printer connection error:', error);
                showManualPrint();
            }
        };

        // Initialize scanner events on load
        setupScannerEvents();
    </script>
</body>
</html>
